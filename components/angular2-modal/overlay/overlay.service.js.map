{"version":3,"file":"overlay.service.js","sourceRoot":"","sources":["overlay.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { ViewContainerRef, Injectable } from '@angular/core';\n\nimport { OverlayRenderer, OverlayConfig } from '../models/tokens';\nimport { DialogRefStack } from '../models/dialog-ref-stack';\nimport { vcRefStore } from '../models/vc-ref-store';\nimport { DialogRef } from '../angular2-modal';\nimport { OverlayContext } from '../models/overlay-context';\n\nconst _stack = new DialogRefStack<any>();\n\n@Injectable()\nexport abstract class Overlay {\n  /**\n   * A Default view container ref, usually the app root container ref.\n   * Make sure not to provide something that might get destroyed, it will destroy the modals too.\n   * The container is used as logical view holder, elements might be moved.\n   * Has to be set manually until we can find a way to get it automatically.\n   */\n  public defaultViewContainer: ViewContainerRef;\n\n  get stackLength(): number {\n    return _stack.length;\n  }\n\n  constructor(private _modalRenderer: OverlayRenderer) {\n  }\n\n  /**\n   * Check if a given DialogRef is the top most ref in the stack.\n   * TODO: distinguish between body modal vs in element modal.\n   * @param dialogRef\n   * @returns {boolean}\n   */\n  isTopMost(dialogRef: DialogRef<any>): boolean {\n    return _stack.indexOf(dialogRef) === _stack.length - 1;\n  }\n\n  stackPosition(dialogRef: DialogRef<any>) {\n    return _stack.indexOf(dialogRef);\n  }\n\n\n  /**\n   * Opens a modal window inside an existing component.\n   */\n  open<T extends OverlayContext>(config: OverlayConfig): DialogRef<T>[] {\n    let viewContainer = config.viewContainer,\n        containers: Array<ViewContainerRef> = [];\n\n    if (typeof viewContainer === 'string') {\n      containers = vcRefStore.getVCRef(viewContainer as string);\n    } else if (Array.isArray(viewContainer)) {\n      containers = viewContainer as any;\n    } else if (viewContainer) {\n      containers = [viewContainer] as any;\n    }\n\n    if (!containers || !containers[0]) {\n      if (!this.defaultViewContainer) {\n        throw new Error('defaultViewContainer not set.');\n      }\n      containers = [this.defaultViewContainer];\n    }\n\n    return containers.map( vc => this.createOverlay(config.renderer || this._modalRenderer, vc, config));\n  }\n\n  private createOverlay(renderer: OverlayRenderer,\n                        vcRef: ViewContainerRef,\n                        config: OverlayConfig): DialogRef<any> {\n    if (config.context) {\n      config.context.normalize();\n    }\n\n    let dialog = new DialogRef<any>(this, config.context || {});\n    dialog.inElement = config.inside === undefined ? !!vcRef : !!config.inside;\n\n    let cmpRef = renderer.render(dialog, vcRef);\n\n    Object.defineProperty(dialog, 'overlayRef', {value: cmpRef});\n    _stack.pushManaged(dialog);\n    dialog.onDestroy.subscribe(() => _stack.remove(dialog));\n\n    return dialog;\n  }\n}\n"]}