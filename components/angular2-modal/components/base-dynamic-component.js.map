{"version":3,"file":"base-dynamic-component.js","sourceRoot":"","sources":["base-dynamic-component.ts"],"names":[],"mappings":"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","sourcesContent":["import { \n  ComponentRef,\n  ComponentFactoryResolver,\n  ElementRef,\n  ResolvedReflectiveProvider,\n  OnDestroy,\n  ViewContainerRef\n} from '@angular/core';\n\nimport { Observable } from 'rxjs/Observable';\nimport { Subject } from 'rxjs/Subject';\n\nimport { DomSanitizationService, SafeStyle } from '@angular/platform-browser';\nimport { createComponent } from '../framework/createComponent';\n\nconst BROWSER_PREFIX = ['webkit', 'moz', 'MS', 'o', ''];\n\nfunction register(eventName, element, cb) {\n  BROWSER_PREFIX.forEach( p => {\n    element.addEventListener(p ? p + eventName : eventName.toLowerCase(), cb, false);\n  });\n}\n\n/**\n * A base class that expose customisation methods in derived components.\n * Capabilities: Add/Remove styls, Add/Remove classes, listen to animation/transition end event,\n * add components\n */\nexport class BaseDynamicComponent implements OnDestroy {\n  animationEnd$: Observable<'transition' | 'animation'>;\n\n  protected animationEnd: Subject<'transition' | 'animation'>;\n  protected style: { [prop: string]: string } = {} as any;\n  protected styleStr: SafeStyle = '';\n  protected cssClass: SafeStyle = '';\n  protected classArray: string[] = [];\n  private applyOnNextTurn: boolean;\n\n  constructor(protected sanitizer: DomSanitizationService, \n              protected el: ElementRef) {}\n  \n  activateAnimationListener() {\n    if (this.animationEnd) return;\n    this.animationEnd = new Subject<'transition' | 'animation'>();\n    this.animationEnd$ = this.animationEnd.asObservable();\n    register('TransitionEnd', this.el.nativeElement, this.onEndTransition.bind(this));\n    register('AnimationEnd', this.el.nativeElement, this.onEndAnimation.bind(this));\n  }\n  /**\n   * Set a specific inline style on the overlay host element.\n   * @param prop The style key\n   * @param value The value, undefined to remove\n   * @returns {ModalOverlay}\n   */\n  setStyle(prop: string, value: string): this {\n    if (this.style[prop] !== value) {\n      if (value === undefined) {\n        delete this.style[prop];\n      } else {\n        this.style[prop] = value;\n      }\n\n      this.applyStyle();\n    }\n    return this;\n  }\n  \n  /**\n   * Remove's all inline styles from the overlay host element.\n   */\n  clearStyles(): void {\n    this.style = {} as any;\n    this.applyStyle();\n  }\n\n  addClass(css: string, nextTurn: boolean = false): void {\n    if (typeof css === 'string') {\n      css.split(' ').forEach( c => this._addClass(c, nextTurn) );\n    }\n  }\n\n  removeClass(css: string, nextTurn: boolean = false): void {\n    if (typeof css === 'string') {\n      css.split(' ').forEach( c => this._removeClass(c, nextTurn) );\n    }\n  }\n\n  ngOnDestroy(): void {\n    if (this.animationEnd && !this.animationEnd.isUnsubscribed) {\n      this.animationEnd.complete();\n    }\n  }\n\n  protected applyStyle(): void {\n    this.styleStr = this.sanitizer.bypassSecurityTrustStyle(JSON.stringify(this.style)\n      .replace('{', '')\n      .replace('}', '')\n      .replace(/,/g, ';')\n      .replace(/\"/g, ''));\n  }\n  \n  protected applyClasses(nextTurn: boolean) {\n    if (nextTurn === true) {\n      if (!this.applyOnNextTurn) {\n        this.applyOnNextTurn = true;\n        setTimeout(() => {\n          this.applyOnNextTurn = false;\n          this.applyClasses(false);\n        });\n      }\n    } else {\n      this.cssClass = this.classArray.join(' ');\n    }\n  }\n   \n  /**\n   * Add a component, supply a view container ref.\n   * Note: The components vcRef will result in a sibling.\n   * @param type The component to add\n   * @param vcRef The container to add to\n   * @param bindings Bindings to use (added on top of the ViewContainerRef)\n   * @returns {Promise<ComponentRef<any>>}\n   */\n  protected _addComponent<T>(type: any,\n                             vcRef: ViewContainerRef,\n                             bindings?: ResolvedReflectiveProvider[]): ComponentRef<T> {\n    const cmpRef =\n      createComponent(vcRef.injector.get(ComponentFactoryResolver), type, vcRef, bindings || []);\n\n    cmpRef.changeDetectorRef.detectChanges();\n\n    return cmpRef;\n  }\n\n  private onEndTransition() {\n    if (!this.animationEnd.isUnsubscribed) {\n      this.animationEnd.next('transition');\n    }\n\n  }\n\n  private onEndAnimation() {\n    if (!this.animationEnd.isUnsubscribed) {\n      this.animationEnd.next('animation');\n    }\n  }\n\n  private _addClass(css: string, nextTurn: boolean = false): void {\n    if (this.classArray.indexOf(css) > -1) return;\n    this.classArray.push(css);\n    this.applyClasses(nextTurn);\n  }\n\n  private _removeClass(css: string, nextTurn: boolean = false): void {\n    const idx = this.classArray.indexOf(css);\n    if (idx > -1) {\n      this.classArray.splice(idx, 1);\n      this.applyClasses(nextTurn);\n    }\n  }\n}\n"]}